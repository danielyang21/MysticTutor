<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Card Search Page</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    header {
        width: 100%;
        background-color: #3b82f6; 
        padding: 20px; 
        text-align: center;
    }


    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #f5f5f5;
    }

    .container {
      display: flex;
      flex-direction: row;
      margin: 20px;
      width: 90%;
      max-width: 2000px;
    }

    .filters {
      width: 20%;
      background-color: #ffffff;
      padding: 20px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }

    .filters h2 {
      margin-bottom: 10px;
    }

    .search-section {
      flex: 1;
      margin-left: 20px;
      display: flex;
      flex-direction: column;
    }

    .search-bar {
      margin-bottom: 20px;
    }

    .search-bar input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        min-height: 400px; 
        grid-auto-rows: minmax(300px, auto); 
    }

    .card {
      background-color: #ffffff;
      padding: 0px;
      border: 1px solid #ddd;
      border-radius: 50px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .card img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px; 
    }

    .card h3 {
      margin-bottom: 10px;
      font-size: 1.2em;
    }

    .card p {
      color: #666;
      font-size: 0.9em;
    }

    .color-filters {
        display: flex;
        justify-content: space-around;
        align-items: center;
        margin-top: 20px;
    }

    .color-btn {
        background: none;
        border: 2px solid transparent;
        width: 50px; /* Set fixed width */
        height: 50px; /* Set fixed height */
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 50%; /* Make button circular */
        cursor: pointer;
        transition: transform 0.2s, border-color 0.2s;
    }

    .color-btn img {
        width: 45px; 
        height: 45px;
        border-radius: 50%;
    }

    .color-btn:hover {
        transform: scale(1.1);
    }

    .color-btn.active {
        border-color: #3b82f6; /* Highlight active button */
    }

  </style>
</head>
<body>
  <header>
    <h1>Card Search Page</h1>
  </header>

  <div class="container">
    <!-- Filters Section -->
    <aside class="filters">
      <h2>Filters</h2>
      <form>
        <label>
          <input type="checkbox" name="filter1">
          Filter 1
        </label><br>
        <label>
          <input type="checkbox" name="filter2">
          Filter 2
        </label><br>
        <label>
          <input type="checkbox" name="filter3">
          Filter 3
        </label>
      </form>
      <div class="color-filters">
        <button class="color-btn" data-color="white" data-selected="false">
          <img src="/static/color-symbols/white-symbol.webp" alt="White" />
        </button>
        <button class="color-btn" data-color="blue" data-selected="false">
          <img src="/static/color-symbols/blue-symbol.webp" alt="Blue" />
        </button>
        <button class="color-btn" data-color="black" data-selected="false">
          <img src="/static/color-symbols/black-symbol.webp" alt="Black" />
        </button>
        <button class="color-btn" data-color="red" data-selected="false">
          <img src="/static/color-symbols/red-symbol.webp" alt="Red" />
        </button>
        <button class="color-btn" data-color="green" data-selected="false">
          <img src="/static/color-symbols/green-symbol.webp" alt="Green" />
        </button>
      </div>

    </aside>

    <!-- Search and Cards Section -->
    <section class="search-section">
      <!-- Search Bar -->
      <div class="search-bar">
        <input type="text" id="search" placeholder="Search for cards...">
      </div>

      <!-- Card Display -->
      <div id="card-grid" class="card-grid"></div>
    </section>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
        const cardGrid = document.getElementById('card-grid');
        const searchInput = document.getElementById('search');

        let files = []; // To store the list of all card files

        try {
            // Fetch the list of filenames from the Flask backend (via the new API route)
            const response = await fetch('/api/card-urls');
            files = await response.json(); // Parse the JSON response

            console.log('Fetched files:', files);  // Log to see the list of files

            // Initially display all cards
            displayCards(files);

        } catch (error) {
            console.error('Error fetching card images:', error);
            cardGrid.innerHTML = 'Failed to load card images.';
        }

        // Event listener to apply the search filter
        searchInput.addEventListener('input', () => {
            const searchText = searchInput.value.toLowerCase();
            const searchWords = searchText.split(/\s+/); // Split by spaces

        // Filter the files based on the search words
        const filteredFiles = files.filter(file => {
            return searchWords.every(word => file.toLowerCase().includes(word));
        });

            // Display filtered cards
            displayCards(filteredFiles);
        });


        const colorButtons = document.querySelectorAll('.color-btn');

        colorButtons.forEach(button => {
        button.addEventListener('click', () => {
            button.classList.toggle('active');

            // Log selected colors (replace with filter logic later)
            const selectedColors = Array.from(colorButtons)
                .filter(btn => btn.classList.contains('active'))
                .map(btn => btn.dataset.color);
            console.log('Selected colors:', selectedColors);

            });
        });

        // Function to display cards in the grid
        function displayCards(files) {
            // Clear the grid before appending new cards
            cardGrid.innerHTML = '';

            // Loop through each file name and create a card for it
            files.forEach(file => {
                const card = document.createElement('div');
                card.className = 'card';
                const imageUrl = '/static/card-urls/' + file; // Build the image URL
                const imageAlt = file.split('.')[0];  // Use the file name (without extension) as alt text

                card.innerHTML = `<img src="${imageUrl}" alt="${imageAlt}">`;
                cardGrid.appendChild(card);
            });
        }
    });
  </script>
</body>
</html>
