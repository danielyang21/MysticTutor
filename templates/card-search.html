<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Card Search Page</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    header {
        width: 100%;
        background-color: #3b82f6; 
        padding: 20px; 
        text-align: center;
    }


    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #f5f5f5;
    }

    .container {
      display: flex;
      flex-direction: row;
      margin: 20px;
      width: 90%;
      max-width: 2000px;
    }

    .filters {
      width: 20%;
      background-color: #ffffff;
      padding: 20px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }

    .filters h2 {
      margin-bottom: 10px;
    }

    .search-section {
      flex: 1;
      margin-left: 20px;
      display: flex;
      flex-direction: column;
    }

    .search-bar {
      margin-bottom: 20px;
    }

    .search-bar input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        min-height: 400px; 
        grid-auto-rows: minmax(300px, auto); 
    }

    .card {
      background-color: #ffffff;
      padding: 0px;
      border: 1px solid #ddd;
      border-radius: 50px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .card img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px; 
    }

    .card h3 {
      margin-bottom: 10px;
      font-size: 1.2em;
    }

    .card p {
      color: #666;
      font-size: 0.9em;
    }

    .color-filters {
        display: flex;
        justify-content: space-around;
        align-items: center;
        margin-top: 20px;
    }

    .color-btn {
        background: none;
        border: 2px solid transparent;
        width: 50px; /* Set fixed width */
        height: 50px; /* Set fixed height */
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 50%; /* Make button circular */
        cursor: pointer;
        transition: transform 0.2s, border-color 0.2s;
    }

    .color-btn img {
        width: 45px; 
        height: 45px;
        border-radius: 50%;
    }

    .color-btn:hover {
        transform: scale(1.1);
    }

    .color-btn.active {
        border-color: #3b82f6; /* Highlight active button */
    }


	.button-54 {
		font-family: "Open Sans", sans-serif;
		font-size: 16px;
		letter-spacing: 2px;
		color: #000;
		cursor: pointer;
		border: 3px solid;
		padding: 0.25em 0.5em;
		box-shadow: 1px 1px 0px 0px, 2px 2px 0px 0px, 3px 3px 0px 0px, 4px 4px 0px 0px, 5px 5px 0px 0px;
		position: relative;
		touch-action: manipulation;
	}

	.button-54:active{
		box-shadow: 0px 0px 0px 0px;
		top: 5px;
		left: 5px;
	}

	.button-54.pressed {
		color:rgb(28, 228, 61);
		box-shadow: 0px 0px 0px 0px;
		top: 5px;
		left: 5px;
	}

	@media (min-width: 768px) {
		.button-54 {
			padding: 0.25em 0.75em;
		}
	}


	

  </style>
</head>
<body>
  <header>
    <h1>Card Search Page</h1>
  </header>

  <div class="container">
    <!-- Filters Section -->
    <aside class="filters">
      <h2>Filters</h2>
      	<div class="color-filters">
			<button class="color-btn" color="white">
			<img src="/static/color-symbols/white-symbol.webp" alt="White" />
			</button>
			<button class="color-btn" color="blue">
			<img src="/static/color-symbols/blue-symbol.webp" alt="Blue" />
			</button>
			<button class="color-btn" color="black">
			<img src="/static/color-symbols/black-symbol.webp" alt="Black" />
			</button>
			<button class="color-btn" color="red">
			<img src="/static/color-symbols/red-symbol.webp" alt="Red" />
			</button>
			<button class="color-btn" color="green">
			<img src="/static/color-symbols/green-symbol.webp" alt="Green" />
			</button>
		</div><br>


        <!-- Keyword Filter Buttons-->
		<button class="button-54" filter="keyword-filter" keyword="banding">Banding</button>
        <button class="button-54" filter="keyword-filter" keyword="defender">Defender</button>
        <button class="button-54" filter="keyword-filter" keyword="first strike">First Strike</button>
        <button class="button-54" filter="keyword-filter" keyword="flying">Flying</button>
        <button class="button-54" filter="keyword-filter" keyword="forestwalk">Forestwalk</button>
        <button class="button-54" filter="keyword-filter" keyword="haste">Haste</button>
        <button class="button-54" filter="keyword-filter" keyword="mountainwalk">Mountainwalk</button>
        <button class="button-54" filter="keyword-filter" keyword="protection from black">Protection from Black</button>
        <button class="button-54" filter="keyword-filter" keyword="protection from white">Protection from White</button>
        <button class="button-54" filter="keyword-filter" keyword="reach">Reach</button>
        <button class="button-54" filter="keyword-filter" keyword="swampwalk">Swampwalk</button>
        <button class="button-54" filter="keyword-filter" keyword="trample">Trample</button>
        <button class="button-54" filter="keyword-filter" keyword="vigilance">Vigilance</button>



		<!-- Save and Reset Buttons -->
		<div style="margin-top: 20px;">
			<button class="button-54" role="button" id="reset-filters">Reset Filters</button>
			<button class="button-54" role="button" id="save-filters">Save Filters</button>
		</div>

    </aside>

    <!-- Search and Cards Section -->
    <section class="search-section">
      <!-- Search Bar -->
      <div class="search-bar">
        <input type="text" id="search" placeholder="Search for cards...">
      </div>

      <!-- Card Display -->
      <div id="card-grid" class="card-grid"></div>
    </section>
  </div>

  	<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const cardGrid = document.getElementById('card-grid');

        let files = []; // To store the list of all card files

        try {
            // Fetch the list of filenames from the Flask backend (via the new API route)
            const response = await fetch('/api/card-urls');
            files = await response.json(); // Parse the JSON response

            // Initially display all cards
            displayCards(files);

        } catch (error) {
            console.error('Error fetching card images:', error);
            cardGrid.innerHTML = 'Failed to load card images.';
        }


		const searchInput = document.getElementById('search');
		searchInput.addEventListener('input', async () => {
            const searchText = searchInput.value.toLowerCase();

			if (searchText === "") displayCards(files);
			else{
				// Filter the files based on the search words
				const response = await fetch(`/api/search?term=${encodeURIComponent(searchText)}`);
				responseFiles = await response.json();

				const filteredFiles = responseFiles.map(tuple => tuple[0]);
				// Display filtered cards
				displayCards(filteredFiles);
			}
        });



        // Event listener to apply the search filter (THIS DOES NOT USE SQL)
		/* const searchInput = document.getElementById('search');
        searchInput.addEventListener('input', () => {
            const searchText = searchInput.value.toLowerCase();
            const searchWords = searchText.split(/\s+/); // Split by spaces

			// Filter the files based on the search words
			const filteredFiles = files.filter(file => {
				return searchWords.every(word => file.toLowerCase().includes(word));
			});

            // Display filtered cards
            displayCards(filteredFiles);
        }); */

		
    	const saveFiltersBtn = document.getElementById('save-filters');
    	const resetFiltersBtn = document.getElementById('reset-filters');
		const colorButtons = document.querySelectorAll('.color-btn');
		const keywordButtons = document.querySelectorAll('[filter = "keyword-filter"]');

		colorButtons.forEach(button => {
			button.addEventListener('click', () => {
				button.classList.toggle('active');
			});
		});

		keywordButtons.forEach(button => {
			button.addEventListener('click', () => {
				button.classList.toggle('pressed');
			});
		})



		// Save Filters button click event
		saveFiltersBtn.addEventListener('click', async () => {
			const activeColors = Array.from(colorButtons)
			.filter(button => button.classList.contains('active'))
			.map(button => button.getAttribute('color'));

			if (activeColors.length > 0) alert('Active colors: ' + activeColors.join(', '));
    	});
        



        // Function to display cards in the grid
        function displayCards(files) {
            // Clear the grid before appending new cards
            cardGrid.innerHTML = '';

            // Loop through each file name and create a card for it
            files.forEach(file => {
                const card = document.createElement('div');
                card.className = 'card';
                const imageUrl = '/static/card-urls/' + file; // Build the image URL
                const imageAlt = file.split('.')[0];  // Use the file name (without extension) as alt text

                card.innerHTML = `<img src="${imageUrl}" alt="${imageAlt}">`;
                cardGrid.appendChild(card);
            });
        }

    });


	</script>
</body>
</html>
